- hosts: all
  gather_facts: False
  pre_tasks:
    - name: cleanup ansible remote tmp dir
      raw: "rm -rf ~/.ansible/tmp"
    - name: install system python
      raw: |
        apt -y update
        if [ "$(lsb_release -c -s)" = 'focal' ]; then
          echo "installing python 3 on Ubuntu"
          apt install -y python3 python-is-python3
        else if grep -q "VERSION_CODENAME=bullseye" /etc/os-release; then
          echo "installing python 3 on Debian"
          apt install -y python3 python-is-python3
        else
          echo "installing python 2"
          apt install -y python
        fi; fi

- hosts: leihs_gateway

  roles:
    - role: os-setup
      tags: [os-setup]

- hosts: [leihs_server]

  roles:
    - role: os-check
      tags: [os-check]

    - role: set_local_tar_cmd
      tags: [always]

    - role: os-setup
      tags: [os-setup]

    - role: openjdk
      tags: [openjdk]

    - role: postgresql
      tags: [postgresql]

    - role: install
      tags: [install]

    - role: ruby-install
      tags: [ruby-install]

    - role: nodejs-install
      tags: [nodejs-install]
      vars:
        debian_repo_version: "14.x" # should be current LTS
