#!/usr/bin/ruby
require 'yaml'
require 'openssl'

if not File::exist? "/leihs/config/master-secret.txt"
  raise "/leihs/config/master-secret.txt is missing"
else
  master_secret = IO::read("/leihs/config/master-secret.txt").strip
  secret_key_base = OpenSSL::HMAC.hexdigest('SHA256', master_secret, "leihs-session" )
  secrets = YAML.load_file('/leihs/legacy/config/secrets.yml')
  secrets['production']['secret_key_base'] = secret_key_base
  IO.write('/leihs/legacy/config/secrets.yml', secrets.to_yaml)
  exit 0
end
