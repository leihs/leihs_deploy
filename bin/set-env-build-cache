#!/bin/bash -eu

USE_S3_BUILD_CACHE="${USE_S3_BUILD_CACHE:-"1"}"
LOCAL_CACHE_DIR_RELATIVE="${LOCAL_CACHE_DIR:-"../tmp/build_cache"}"
LOCAL_CACHE_DIR="$(cd -- "$(dirname "${BASH_SOURCE}")" && mkdir -p "$LOCAL_CACHE_DIR_RELATIVE" && cd "$LOCAL_CACHE_DIR_RELATIVE" && pwd -P)"
S3_CI_ENDPOINT="${S3_CI_ENDPOINT:-${S3_CACHE_ENDPOINT:-"https://s3.dev.leihs.app"}}"
S3_CI_CACHE_BUCKET="${S3_CI_CACHE_BUCKET:-${S3_CACHE_BUCKET:-"leihs-build-cache-dev"}}"
AWS_ACCESS_KEY_ID="${AWS_ACCESS_KEY_ID:-${S3_ACCESS_KEY_ID:-}}"
AWS_SECRET_ACCESS_KEY="${AWS_SECRET_ACCESS_KEY:-${S3_SECRET_ACCESS_KEY:-}}"

if test ! "$USE_S3_BUILD_CACHE" -o "$USE_S3_BUILD_CACHE" = "no" ; then
  unset S3_CI_ENDPOINT
  unset S3_CI_CACHE_BUCKET
  unset AWS_ACCESS_KEY_ID
  unset AWS_SECRET_ACCESS_KEY
fi

export USE_S3_BUILD_CACHE
export LOCAL_CACHE_DIR
export S3_CI_ENDPOINT
export S3_CI_CACHE_BUCKET
export AWS_ACCESS_KEY_ID
export AWS_SECRET_ACCESS_KEY
