#!/usr/bin/ruby
require 'yaml'
require 'openssl'
require 'securerandom'

sleep 1

master_secret = IO::read("/leihs/config/master-secret.txt").strip rescue SecureRandom.base64(32)

secret_key_base = OpenSSL::HMAC.hexdigest('SHA256', master_secret, "leihs-session" )
secret_token = OpenSSL::HMAC.hexdigest('SHA256', master_secret, "leihs-token" )

secrets = YAML.load_file('/leihs/legacy/config/secrets.yml')
secrets['production']['secret_key_base'] = secret_key_base
secrets['production']['secret_token'] = secret_token
IO.write('/leihs/legacy/config/secrets.yml', secrets.to_yaml)
exit 0
