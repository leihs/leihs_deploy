- name: create shared-ui
  delegate_to: '{{ build_host_nodejs }}'
  args:
    executable: /bin/bash
  shell: |
    set -eux
    DEPLOY_DIR='{{playbook_dir}}'
    cd "${DEPLOY_DIR}/../admin"
    sh scripts/prepare-shared-ui.sh

- name: make shared-ui tarball
  delegate_to: '{{ build_host_nodejs }}'
  command: 'tar -cvz -f "{{playbook_dir}}/../admin/leihs-ui.tgz" .'
  args:
    chdir: '{{playbook_dir}}/../admin/leihs-ui'
    creates: '{{playbook_dir}}/../admin/leihs-ui.tgz'

- name: create empty {{leihs_admin_dir}}/leihs-ui
  file:
    path: '{{leihs_admin_dir}}/leihs-ui'
    state: directory
    owner: '{{leihs_admin_user}}'
    recurse: yes

- name: copy shared-ui over to server
  unarchive:
    src: '{{playbook_dir}}/../admin/leihs-ui.tgz'
    dest: '{{leihs_admin_dir}}/leihs-ui'
    owner: '{{leihs_admin_user}}'
